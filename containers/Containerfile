FROM registry.access.redhat.com/ubi8/ubi:latest as builder
RUN dnf install -y make git unzip gcc openssl-devel
RUN git clone https://github.com/wg/wrk.git --depth=1
RUN git clone https://github.com/giltene/wrk2.git --depth=1
RUN cd wrk && make -j $(nproc)
RUN cd wrk2 && make -j $(nproc)

FROM registry.access.redhat.com/ubi8/ubi:latest
RUN dnf install -y iproute procps-ng
COPY --from=builder /wrk/wrk /usr/bin/wrk
COPY --from=builder /wrk2/wrk /usr/bin/wrk2
COPY json.lua json.lua
